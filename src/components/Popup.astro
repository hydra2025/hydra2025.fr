---
import type { Member } from "../organigramme";
import linkedin from "../assets/socials/linkedin.svg?raw";
import facebook from "../assets/socials/facebook.svg?raw";
import Image from "astro/components/Image.astro";

interface Props {
  membre: Member;
}

const { membre } = Astro.props;

const id1 = Math.random().toString(36).slice(2, 11);
const id2 = Math.random().toString(36).slice(2, 11);
---

{membre._has_overlay && <div class="overlay" id="contenu" />}
<div class="popup" id={id2}>
  <div class="border"></div>
  <div class="image">
    {
      membre.img ? (
        <Image
          src={membre.img}
          alt={`Photo de ${membre.first_name}`}
          class="picture"
        />
      ) : (
        <div class="placeholder" />
      )
    }
  </div>
  <div class="infos">
    <span class="question">Prénom :</span>
    <span class="answer first-name">{membre.first_name}</span>
    <span class="question">Nom :</span>
    <span class="answer last-name">{membre.last_name}</span>
    <span class="question">Rôle :</span>
    <span class="answer role">{membre.role}</span>
    <span class="question">Respo :</span>
    <span class="answer respo">{membre.respo ? "Oui" : "Non"}</span>
  </div>
</div>
<div class="bouton" id={id1}>
  <div class:list={["border", { respo: membre.respo }]}></div>
  <div class="imageBouton">
    {
      membre.img ? (
        <Image
          src={membre.img}
          alt={`Photo de ${membre.first_name}`}
          class="picture"
        />
      ) : (
        <div class="placeholder" />
      )
    }
  </div>
  <div class="bottom">
    <div class="info">
      <div class="first-name">{membre.first_name}</div>
      <div class="last-name">{membre.last_name}</div>
      <div class="role">{membre.role}</div>
    </div>
    <div class="socials">
      {
        membre.linkedin && (
          <a
            href={membre.linkedin}
            title={`Page LinkedIn de ${membre.first_name}`}
            class="social"
            target="_blank"
          >
            <Fragment set:html={linkedin} />
          </a>
        )
      }
      {
        membre.facebook && (
          <a
            href={membre.facebook}
            title={`Profil Facebook de ${membre.first_name}`}
            class="social"
            target="_blank"
          >
            <Fragment set:html={facebook} />
          </a>
        )
      }
    </div>
  </div>
</div>

<script define:vars={{ membre, id1, id2 }} is:inline>
  const overlay = document.querySelector(".overlay");
  const bouton = document.getElementById(id1);
  const popup = document.getElementById(id2);

  bouton.addEventListener("click", () => {
    overlay.style.display = "block";
    popup.style.display = "flex";
    bouton.style.opacity = "0";

    setTimeout(() => (popup.style.width = "min(100vw, 40em)"), 300);
  });

  overlay.addEventListener("click", () => {
    popup.style.width = "0";
    setTimeout(() => {
      overlay.style.display = "none";
      popup.style.display = "none";
      bouton.style.opacity = "1";
    }, 600);
  });
</script>

<style>
  .overlay {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 5;
    backdrop-filter: blur(10px);
  }

  .popup {
    width: 0;
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 6;
    flex-direction: row;
    padding: 2rem;
    background-color: rgba(var(--color-background-rgb), 0.5);
    backdrop-filter: blur(10px);
    pointer-events: none;
    clip-path: polygon(
      50px 0%,
      0% 50px,
      0% calc(100% - 20px),
      20px 100%,
      calc(80% - 10px) 100%,
      80% calc(100% - 10px),
      calc(100% - 30px) calc(100% - 10px),
      100% calc(calc(100% - 10px) - 30px),
      100% 0%,
      50px 0%
    );
    transition: width 0.3s ease;
  }
  .popup .border {
    opacity: 1;
    z-index: 7;
  }

  .popup .picture,
  .popup .placeholder {
    width: 15em;
    height: 15em;
    margin-bottom: 1rem;
    margin-right: 2rem;
    background-color: var(--color-secondary);
    clip-path: polygon(25px 0%, 0% 25px, 0% 100%, 100% 100%, 100% 0%, 50px 0%);
  }

  .popup .infos {
    display: grid;
    column-gap: 1rem;

    grid-template-columns: 1fr 1fr;
    width: 100%;
    height: fit-content;
    font-size: 1.2rem;
    color: var(--color-text);
  }

  .popup .question {
    font-weight: lighter;
    text-align: right;
    box-sizing: content-box;
    display: block;
    align-self: baseline;
  }
  .popup .answer {
    font-weight: bold;
    display: block;
    font-family: var(--font-family-title);
    text-align: left;
    font-size: 1.3rem;
    align-self: baseline;
  }

  .bouton {
    padding: 2.5rem 2.5rem 2rem 2.5rem;
    box-sizing: border-box;
    text-align: left;
    background-color: rgba(var(--color-primary-rgb), 0.1);
    backdrop-filter: blur(10px);
    position: relative;
    opacity: 1;
    clip-path: polygon(
      50px 0%,
      0% 50px,
      0% calc(100% - 20px),
      20px 100%,
      calc(80% - 10px) 100%,
      80% calc(100% - 10px),
      calc(100% - 30px) calc(100% - 10px),
      100% calc(calc(100% - 10px) - 30px),
      100% 0%,
      50px 0%
    );
    transition:
      background-color 0.3s ease,
      opacity 0.5s ease;
  }

  .picture,
  .placeholder {
    width: 12em;
    height: 12em;
    margin-bottom: 1rem;
    background-color: var(--color-secondary);
    transition:
      transform 0.3s ease,
      border-radius 0.3s ease;
    clip-path: polygon(25px 0%, 0% 25px, 0% 100%, 100% 100%, 100% 0%, 50px 0%);
  }

  .bouton .picture {
    object-fit: cover;
  }

  .bouton:hover .picture,
  .bouton:hover .placeholder {
    border-radius: 5px;
    cursor: pointer;
    transform: scale(1.05);
  }

  .border {
    position: absolute;
    inset: 0;
    opacity: 0.3;
    background-color: var(--color-primary);
    z-index: 0;
    clip-path: polygon(
      50px 0%,
      0% 50px,
      0% calc(100% - 20px),
      20px 100%,
      calc(80% - 10px) 100%,
      80% calc(100% - 10px),
      calc(100% - 30px) calc(100% - 10px),
      100% calc(calc(100% - 10px) - 30px),
      100% 0%,
      50px 0%,
      calc(3px + calc(50px - calc(3px * 0.7071067811865475))) 3px,
      calc(100% - 3px) 3px,
      calc(100% - 3px)
        calc(
          calc(calc(100% - 10px) - 3px) -
            calc(30px - calc(3px * 0.7071067811865475))
        ),
      calc(calc(100% - 3px) - calc(30px - calc(3px * 0.7071067811865475)))
        calc(calc(100% - 10px) - 3px),
      calc(calc(80% - 3px) + calc(3px * 0.7071067811865475))
        calc(calc(100% - 3px) - 10px),
      calc(calc(80% - 3px) - calc(10px - calc(3px * 0.7071067811865475)))
        calc(100% - 3px),
      calc(3px + calc(20px - calc(3px * 0.7071067811865475))) calc(100% - 3px),
      3px calc(calc(100% - 3px) - calc(20px - calc(3px * 0.7071067811865475))),
      3px calc(3px + calc(50px - calc(3px * 0.7071067811865475))),
      calc(3px + calc(50px - calc(3px * 0.7071067811865475))) 3px
    );

    transition: opacity 0.3s ease;
  }

  .bouton .border.respo {
    opacity: 0.9;
  }

  .bouton .bouton:hover .border {
    opacity: 1;
  }
  .bouton .bouton:hover {
    cursor: pointer;
    background-color: rgba(var(--color-primary-rgb), 0.2);
  }

  .bouton .imageBouton {
    text-align: center;
  }

  .bouton .bottom {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-top: 1rem;
    height: fit-content;
  }
  .bouton .socials {
    display: flex;
    flex-direction: column;
    height: 100%;
    gap: 0.25em;
  }
  .bouton .social {
    width: 1.5em;
    height: 1.5em;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 50%;
    transition: transform 0.3s ease;
    color: var(--color-primary);
  }

  .bouton .social:hover {
    transform: scale(1.2);
  }
  .bouton .last-name {
    text-transform: uppercase;
    font-weight: bold;
  }
  .bouton .role {
    opacity: 0.7;
    font-size: 0.9rem;
  }
</style>
